{"version":3,"sources":["../../src/pages/chat-list/chat-list.module.ts","../../src/pages/chat-list/chat-list.ts"],"names":[],"mappings":"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","file":"22.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ChatListPage } from './chat-list';\n\n@NgModule({\n  declarations: [\n    ChatListPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ChatListPage),\n  ],\n})\nexport class ChatListPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/chat-list/chat-list.module.ts","import { Component } from '@angular/core';\nimport { \n  IonicPage, \n  NavController, \n  NavParams,\n  Loading,\n  LoadingController\n } from 'ionic-angular';\n import { TaskProvider } from \"../../providers/task/task\";\nimport { ChatProvider } from \"../../providers/chat/chat\";\nimport { ProfileProvider } from \"../../providers/profile/profile\";\n/**\n * Generated class for the ChatListPage page.\n *\n * See https://ionicframework.com/docs/components/#navigation for more info on\n * Ionic pages and navigation.\n */\n\n@IonicPage()\n@Component({\n  selector: 'page-chat-list',\n  templateUrl: 'chat-list.html',\n})\nexport class ChatListPage {\n  public chatlist : Array<any>;\n  public loading: Loading = null;\n  public year: number;\n  public month: number;\n  public date: number;\n\n  constructor(\n    public navCtrl: NavController, \n    public navParams: NavParams,\n    public chatProvider: ChatProvider,\n    public profileProvider: ProfileProvider,\n    public loadingCtrl: LoadingController,\n    public taskProvider: TaskProvider,\n  ) {}\n\n  ionViewDidEnter() {\n    this.timeConverter(Date.now());\n    console.log('ionViewDidLoad ChatListPage');\n    this.loading = this.loadingCtrl.create();\n    this.loading.present();\n    setTimeout(() => {\n      if(this.loading != null){\n        this.loading.dismiss();\n        this.loading =null;\n      }\n      \n    }, 10000);\n    this.chatProvider.getChatList()\n    .orderByChild('timestamp')\n    .on(\"value\", chatListSnapshot => {\n      this.chatlist = [];\n      chatListSnapshot.forEach(snap => {\n        this.profileProvider.getOtherProfile(snap.val().buddyId).on(\"value\", userProfileSnapshot => {\n          this. taskProvider\n            .getTaskDetail(snap.val().taskId)\n            .once(\"value\", taskSnapshot => {\n              var a = new Date(0-snap.val().timestamp );\n            this.chatlist.push({\n              id: snap.key,\n              lastmsg: snap.val().lastmsg,\n              timestamp: 0-snap.val().timestamp,\n              display: (a.getDate()!=this.date || a.getMonth()+1!= this.month || a.getFullYear() != this.year)? false: true,\n              taskName: taskSnapshot.val().name,\n              buddyId: snap.val().buddyId,\n              taskId: snap.val().taskId,\n              photo: userProfileSnapshot.val().photo,\n              buddyName: userProfileSnapshot.val().firstName,\n              read: snap.val().read\n            });\n          });\n        });\n        return false;\n      });\n      if(this.loading != null){\n        this.loading.dismiss();\n        this.loading =null;\n      }\n    });\n  }\n\n  goToChatroom (taskId, buddyId): void{\n    console.log(\"list\",taskId);\n    this.navCtrl.push('ChatroomPage', {buddyId: buddyId, taskId: taskId});\n  }\n\n  timeConverter(UNIX_timestamp){\n    var a = new Date(UNIX_timestamp );\n    // var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    this.year = a.getFullYear();\n    this.month = a.getMonth()+1;\n    this.date = a.getDate();\n    var hour = a.getHours();\n    var min = a.getMinutes();\n    var sec = a.getSeconds();\n  }\n\n  doRefresh(refresher) {\n    console.log('Begin async operation', refresher);\n    this.ionViewDidEnter();\n    setTimeout(() => {\n      console.log('Async operation has ended');\n      refresher.complete();\n    }, 2000);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/chat-list/chat-list.ts"],"sourceRoot":""}